# Qt Nullclient

## About

This Linux (WSL) program serves as a _proof of concept_ that implements the functionality of pidgin's `nullclient.c` program (which is a text-based, command-line program) in a Qt GUI application window. The original `nullclient.c` program can be found in `pidgin/libpurple/example`.

The original `nullclient.c` program displays a text-based list of available pidgin chat plugin protocols, prompts the user to select one of the protocols by menu number, further prompts the user for username and password credentials, and attempts to establish a connection to the selected protocol (_e.g.,_ AIM ... if it was still around!). Upon a successful connection, a message indicating as much is displayed in the terminal.

This instant Qt rendition accomplishes the same basic functionality as its text-based predecessor in the most minimalistic manner possible since it is intended to be only a proof of concept.

Qt (pronounced "cute") is a widget toolkit and IDE (_Qt Creator_) that can be used to create graphical user interfaces (GUIs) and cross-platform applications in C++. Athough it is a commercial product developed by _The Qt Company_, there is a free version for open source users. _Qt Creator_ (the IDE) is available as a download for various operating systems. Qt's official website is [here](https://qt.io).

The `Qt Nullclient` program is one very small part of an ongoing Senior Project undertaken by undergraduate students at the University of Florida.

## Branch information

This `qt-nullclient` branch was created from the GitHub repository's `v2.14.1-release` tag, which is a stable version of the pidgin program. For those who are unfamiliar with the concept of _tags_, an easy-to-understand YouTube video can be found [here](https://www.youtube.com/watch?v=govmXpDGLpo).

## Approach taken to develop Qt Nullclient program

The below summarizes the general approach taken to develop the Qt Nullclient program. (This is not to be confused with the process of building the repository source code, which appears further below.)

- Succesfully build pidgin from repository files, which was the most challenging task and requires installing and configuring certain dependencies (_e.g.,_ XLaunch).
- Install the _Qt Creator_ IDE application.
- Create nullclient's Qt interface initially in _Qt Creator_ and copy needed C++ code files that were auto-generated by the IDE over to the C++ project folder. (Using _Qt Creator_ was not _required_, as the application window can be built line-by-line using C++, but the IDE facilitated and simplified the layout construction process.)
- Re-write C language code from the original `nullclient.c` as C++ code that can work in conjunction with the Qt C++ code. The bulk of this conversion process involved changing C language data types to make them compatible with the C++ compiler. As this project continues, the prospect of declaring `extern "C"` functions that can be called from C++ code should be evaluated.

## Getting started with Qt Nullclient

Building the source code and running the program involves the following steps:
- [Install Ubuntu WSL (20.04)](###install-ubuntu-wsl)
- [Install XLaunch](###install-xlaunch)
- [Set up, get, and configure pidgin source code](###get-source-code)
- [Configure and run XLaunch](###run-xlaunch)
- [Build the pidgin source code](###build-pidgin-source-code)
- [Obtain chat account(s)](###obtain-chat-account(s))
- [Run and test the pidgin program](###run/test-pidgin-program)
- [Build and run the Qt Nullclient program](###build/run-qt-nullclient-source-code)

### Install Ubuntu WSL
The development environment used was the Windows Subsystem for Linux (WSL) and more specifically WSL2 and Ubuntu 20.04 LTS on Windows. (Note: a "local user" is required and not just "root".) An installer for the Ubuntu distro can be found at the official Microsoft Store for [Ubuntu 20.04 LTS](https://www.microsoft.com/en-us/p/ubuntu-2004-lts/9n6svws3rx71?activetab=pivot:overviewtab). (Other standards include C++17 and gcc.)

Please note that installing, enabling, and configuring WSL for the first time can be a tricky process. For instance, WSL requires a particular version of the Windows OS or higher. This README does not go into depth as to this process, but online resources and troubleshooting guides are plentiful. An official WSL installation guide can be found [here](https://docs.microsoft.com/en-us/windows/wsl/install-win10). 

### Install XLaunch

XLaunch is a tool that allows the running of GUI software applications from WSL on Windows computers. A brief discussion on this can be found at this [blog post](https://www.artemix.org/blog/linux-softwares-on-windows.html).

One download source for VcXsrv, which allows the Windows system to use X Server as the standard GUI environment, via XLaunch, is at [SourceForge](https://sourceforge.net/projects/vcxsrv/).

### Get source code

A script file has been created that installs dependencies, clones this instant _single_ remote repository branch, and configures certain settings. This script file, named `pidgin-focal-setup-qtnullclient_sh.sh` can be individually (manually) downloaded from the `pidgin\qtnullclient\` folder above. Alternatively copy/paste the following script into a new `.sh` file and save it (_i.e.,_ as `pidgin-focal-setup-qtnullclient_sh.sh`).

```sh
#!/usr/bin/env bash
sudo apt update
sudo apt upgrade
sudo apt install intltool libgtkspell-dev libxml++2.6-dev libgstreamer-plugins-base1.0-dev libfarstream-0.2-dev libidn11-dev libmeanwhile-dev libavahi-glib-dev libavahi-client-dev libnm-dev libperl-dev libgnutls28-dev tk-dev pidgin-dev
git clone --branch qt-nullclient https://github.com/cacticouncil/pidgin.git ~/pidgin
export _TMP_NS="\$(tail -1 /etc/resolv.conf | cut -d' ' -f2)"
export _TMP_HOST=$(if [ $WSL_INTEROP ]; then echo $_TMP_NS; else echo "localhost"; fi)
echo -e "export WSL_HOST=$_TMP_HOST" >> ~/.profile
echo -e "export DISPLAY=\$WSL_HOST:0" >> ~/.profile
cd ~/pidgin
./configure
```
Then, from a WSL Ubuntu prompt, navigate to the root folder where you want to install the local repository and execute the following three commands:

```sh
user@pc:~/projects$ chmod +x pidgin-focal-setup-qtnullclient_sh.sh
user@pc:~/projects$ run pidgin-focal-setup-qtnullclient_sh.sh
user@pc:~/projects$ run "source ~/.profile"
```
### Run XLaunch

Run the XLaunch application and match the configuration settings to those from each of the screenshots below.

&nbsp;&nbsp;&nbsp;&nbsp;_Screenshot #1:_
<center><img src="https://i.ibb.co/kKC7zhc/xlaunch-screenshot-1.png" alt="Select Multiple windows radio button" width=80% height=80%></center>

&nbsp;&nbsp;&nbsp;&nbsp;_Screenshot #2:_
<center><img src="https://i.ibb.co/zNhbkrf/xlaunch-screenshot-2.png" alt="Select Start no client radio button" width=80% height=80%></center>

&nbsp;&nbsp;&nbsp;&nbsp;_Screenshot #3:_
<center><img src="https://i.ibb.co/56VZbtH/xlaunch-screenshot-3.png" alt="Check ALL three boxes" width=80% height=80%></center>

&nbsp;&nbsp;&nbsp;&nbsp;_Screenshot #4:_
<center><img src="https://i.ibb.co/KKwtX2r/xlaunch-screenshot-4.png" alt="Optionally Save configuration" width=80% height=80%></center>

### Build pidgin source code
To build pidgin, run the following commands at the command line:

```sh
user@pc:~/projects$ cd pidgin
user@pc:~/projects/pidgin$ make
user@pc:~/projects/pidgin$ sudo make install
```

### Run/test pidgin program
_Note:_ The command `sudo ldconfig` should be run after each build if any libraries were rebuilt.

To run pidgin, simply run the program name at the command line:

```sh
user@pc:~/projects/pidgin$ pidgin
```
This should launch the original pidgin application GUI built with GTK, which, after signing in with appropriate chat account login credentials, will serve as verification that the build process was successful.

_Caution:_ Care should be taken to ensure that other existing pidgin binaries are not inadvertently being run for those users who may have previously installed pidgin. In such instances, a `whereis pidgin` command may prove helpful.

### Obtain chat account(s)
Both the original `nullclient.c` and new 'Qt Nullclient` programs default to only ten available libpurple chat plugin protocols. To properly test the program(s), the user should have at least one - and ideally two - chat user accounts from this list of ten default plugins.

Although there are numerous options, one simple option is to obtain a new Jabber/XMPP account at [Hot-Chilli](https://jabber.hot-chilli.net/forms/create/), which is a free service based in Germany. Upon successfully creating a new Jabber/XMPP account, it can be added in a pidgin `Add Account` window as shown below that is arrived at via menu options `Accounts > Manage Accounts > Add`.

<center><img src="https://i.ibb.co/q74LMtQ/pidgin-screenshot-1.png" alt="Pidgin application window" width=80% height=80%></center>

_Optional:_
In addition to testing the new chat account as above, you also may desire to build and run the original text-based `nullclient.c` program. If so, run the following commands at the command line in a _new_ terminal (if pidgin is still running):

```
user@pc:~/projects/pidgin$ cd libpurple/example
user@pc:~/projects/pidgin/libpurple/example$ make
user@pc:~/projects/pidgin/libpurple/example$ ./nullclient
```

You should be able access your newly created Jabber/XMPP chat account via this program (after quitting pidgin), the sole purpose of which is to establish a connection.

### Build/run Qt Nullclient source code

To build the Qt Nullclient program, in a _new_ terminal (if pidgin is running), navigate back to the pidgin root directory and run the following commands at the command line:

```sh
user@pc:~/projects/pidgin$ cd qtnullclient
user@pc:~/projects/pidgin$ cd qmake qtnullclient.pro
user@pc:~/projects/pidgin$ cd make
user@pc:~/projects/pidgin$ cd ./qtnullclient
```

(Qmake is a Qt utility that auto-generates the needed makefile.)

So long as XLaunch is running in the background, a new Qt-based window application window should launch.

To use the program with the same Jabber/XMPP chat account as previously obtained, you should first quit the other running pidgin application or alternatively have a second chat account on hand.  Then select and mouse left-click the option for `8. XMPP`, enter your login credentials, and click on the `Connect` button. Upon a successful connection being made, the `Status` text box display should be updated, indicating that the connection indeed was made, and your application window should look similar to the following:

<center><img src="https://i.ibb.co/NnWVbpf/qtnullclient-screenshot-1.png" alt="Qt Nullclient application window" width=80% height=80%></center>

To view the process in further detail:
- Create a second Jabber/XMPP user account.
- Launch the GTK pidgin program, add one of the two accounts, and then add the second account as a `Buddy`.
- Place the terminal window side-by-side with the `Qt Nullclient` application window.
- Login using the second chat Jabber/XMPP account.

By doing so, as pictured in the animated GIF below, you can visually see the Buddy's availability change as you first log into the `Qt Nullclient` application and later exit. You also can see the connection status being updated during the login process at the command line.

<center><img src="https://i.ibb.co/FnsB16F/qt-pidgin-nullclient-demo-210408.gif" alt="Qt Nullclient animated GIF" width=100% height=100%></center>

## Bugs/TODOs
- Provide error checking (_e.g.,_ user fails to select a protocol from menu).
- The list of pidgin plugin protocols are hard-coded in Qt Creator, as opposed to retrieved from the libpurple back-end as is the case in the original `nullclient.c` program. This type of functionality could be replicated in this instant Qt GUI program.
- Display appropriate message in status window for different results other than a successful connection (_e.g.,_ error messages).
- Replace global function pointer in `main.cpp` with more suitable alternative.
- Add/expand/proof comments to code.

## Future considerations
- Evaluate using `extern "C"` in C++ programs to minimize re-writing existing libpurple code.
- Evaluate warning messages issued during make process that mainly involve existing libpurple code.
- Add more timely plugin protocols, e.g., Slack.
- Add further functionality, of course ... like actually being able to send/receive messages!

## Other notes
- Hyperlinks to external sources were provided for the convenience of the reader. These links were working at the time this README document was written, but naturally these could become non-functional over time.

## Contact

Upon finding any errors, bugs, etc., please feel free to contact any of the team members working on this project, including johnliu@ufl.edu.